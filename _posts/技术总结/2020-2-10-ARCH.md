---
layout:     post
title:      嵌入式软件架构怎么设计
category: 架构设计
description: 嵌入式软件架构怎么设计
tags: arch
---

# 嵌入式软件架构怎么设计

## 嵌入式是否需要架构设计
简单的单片机程序一般不需要，复杂的嵌入式系统是必须要有架构设计。做架构设计的目的是为了减少人力，提升效率。好的架构体现了软件的灵活性，变更与需求范畴等比，而与需求形状无关。<br>
但为什么真正的嵌入式架构师又不多呢？因为内核、RTOS、甚至UEFI本身就有很好的架构，如果系统不复杂的情况下，开发人员只要沿用现有架构即可。 但如果系统需要承载很多的需求和功能时，这就需要架构人员来提供架构设计，从整体上把握，使得软件具备扩展性、健壮性。<br>
所以嵌入式开发人员不能仅仅只会Debug，还需要有职业上的规划，可以往内核方向发展，深入浅出地了解内核设计，做Contribution，也可以从嵌入式架构方向发展。

## 怎么做嵌入式设计
《架构简洁之道》给出了答案。
首先，遵循的设计原则（SOLID）有：
- 1. SRP单一职责原则。 可以参考Linux Bash的设计实现。

- 2. OCP开闭原则：对修改关闭，对新增开放。这需要保存高层抽象的稳定性，让底层依赖与高层代码，只需要增加底层的不同实现即可。

- 3. LSP里式替换原则：如果想用可替换的组件来构建系统，这些组件必须遵循同一个约定。

- 4. 接口隔离原则

- 5. DIP依赖反转：高层策略性代码不应该依赖底层细节的代码。底层实现细节代码应该依赖高层策略性代码。 参考Linux文件系统架构。

其中，组件设计原则有聚合（REP、CCP、CRP）、耦合（无环依赖、稳定性依赖、稳定性抽象），这里可以参考KO的设计。

架构原则 
- 保留可选项：策略和细节分离，尽可能长时间保留尽可能多的可选项，例如开源软件包，硬件平台等
- 独立性：独立开发、独立部署
- 解耦：架构水平分层，用例垂直切片
- 划分边界： 软件架构本事就是一门边界划分的艺术，包括对可选项边界的划分；

常用架构有：分层架构、功能架构、SOA架构、微服务架构。<br>

讲完原则性的内容，那么重点来了，怎么做架构设计，嵌入式架构设计最核心的部分就是边界划分：<br>
1、根据上面整洁架构原则，首先要分析系统要支撑的业务，画出用例图。根据用例图分析数据转换流程。<br>
2、根据用例图和数据流图，描绘该系统从输入数据到输出的所有业务流程。<br>
3、将多个业务流程划分边界。可以预留不完全边界，用于扩展。<br>
4、进行边界划分后，可以用时序图来表达用例业务各边界的交互依赖。用活动图表达边界内业务处理的具体动作流程。<br>
5、明确边界内的业务动作后，可以对业务进行抽象设计，从而保持业务策略代码的稳定性，支撑业务实体的变化性。<br>
6、明确边界间的依赖关系后，可以对业务边界设计详细的接口。在不完全边界上也要设计接口或者抽象的API来调用。